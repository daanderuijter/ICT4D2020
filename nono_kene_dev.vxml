<?xml version="1.0" encoding="UTF-8"?>
<vxml version = "2.1" >

<var name="quantity"/>
<var name="path" expr="'https://raw.githubusercontent.com/daanderuijter/ICT4D2020/dev/wavs/'"/>
<var name="uid" expr="'devTestID'"/>

<!-- Welcome message -->
<form id="welcomeMessage">
<block>
<prompt bargein="false">
	<audio expr="path + 'welcome_message.wav'">
		This is some backup TTS if the audio file fails. 
	</audio>
</prompt>
<goto next="#MainMenu"/>
</block>
</form>

<!-- Menu for Selecting Buy or Sell using DTMF-->
<menu id="MainMenu" dtmf="true" scope="dialog">   
	<prompt bargein="true">
		<audio expr="path + 'menu_select_buy_or_sell.wav'">
			If you want to buy Milk press 1. If you want to sell Milk press 2.
		</audio>
	</prompt>
	<choice event="buy" dtmf="1" message="Buy"></choice>
	<choice next="#sell" dtmf="2"></choice>
</menu>

<catch event="buy">
	<prompt>
 		<audio expr="path + 'menu_buy_milk_chosen.wav'">
  			You have chosen to buy milk.
		</audio>
  		<break time="1000"/>
 	</prompt>
<goto next="#EndMenu"/>
</catch> 

<catch event="correctSell_event">
<goto next="#correctSell"/>
</catch>

<menu id="sell" dtmf="true" scope="dialog">
	<prompt bargein="true">
   		<audio expr="path + 'menu_sell_milk_chosen.wav'">
   			You have chosen to sell milk. If this is incorrect press 1. Otherwise, press 2.
		</audio>
   </prompt>
   <choice next="#MainMenu" dtmf="1"></choice>
   <choice event="correctSell_event" dtmf="2"></choice>
</menu>

<form id="correctSell">
      <record name="sellRecording" 
            maxtime="60s" dtmfterm="true" beep="true">
         <prompt>
			<audio expr="path + 'wavs/sell_quantity_enter.wav'"> 
				Enter your name, phone number and the quantity of milk to sell, and press hash.
			</audio>
         </prompt>

         <!-- if the user doesn't say anything 
            within finalsilence, catch the noinput -->
         <noinput>
			<prompt>
			Sorry. I didn't hear you. Now returning to the main menu.
			</prompt>
         <goto next="#correctSell"/>
         </noinput>

         <filled>
             <!-- demo record shadow variables -->
             <log>recording size = 
                   <value expr="sellRecording$.size"/> bytes.</log>
             <log>recording duration = 
                   <value expr="sellRecording$.duration"/> milliseconds.</log>
             <log>dtmf key = <value expr="(sellRecording$.termchar 
                   ? sellRecording$.termchar : 'none')"/></log>
             <log>maxtime = 
                   <value expr="sellRecording$.maxtime"/>.</log>
			<goto next="#sellConfirm"/>
         </filled>
      </record>
</form>

<menu id="sellConfirm" dtmf="true" scope="dialog">
	<prompt bargein="true">
		<audio expr="path + 'sell_quantity_confirm.wav'">
			Your recorded advertisement to sell milk is
		</audio>
			<audio expr="personal_greeting"/>
			<break time="500"/>
		<audio expr="path + 'sell_confirm_correct_or_incorrect.wav'">
			If this is incorrect press 1. Otherwise, press 2
		</audio>
	</prompt>
   <choice next="#correctSell" dtmf="1"></choice>
   <choice next="#EndMenu" dtmf="2"></choice>
</menu>

<menu id="EndMenu" dtmf="true" scope="dialog">
   <prompt bargein="false">
   		<audio expr="path + 'end_menu.wav'">
   			If you want to end the call, press 1. If you want to go back to the start, press 2
   		</audio>
   </prompt>
   <choice event="end" dtmf="1"></choice>
   <choice next="#MainMenu" dtmf="2"></choice>
</menu>

<!-- end event. close call-->
<catch event="end"> 
   <prompt>Goodbye!</prompt>
   <disconnect/> 
</catch>
</vxml>
